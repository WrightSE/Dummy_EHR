<!DOCTYPE html>
<html lang = "en">
<head>
  <meta charset="utf-8">
  <meta name = "viewport" content = "width=device-width, intial-scale=1.0">
  <title>Dummy Firebase Writing</title>
</head>
<body>
<h1>Patient</h1>
  <label>First Name: </label><input id = "ptFName" type = "text">
  <label>Last Name: </label><input id = "ptLName" type = "text">
<h2>General Info</h2>
  <label>SS#: </label><input id = "ssNum" type = "text">
  <label>Height: </label><input id = "hgt" type = "text">
  <label>Weight: </label><input id = "wgt" type = "text">
  <label>DOB: </label><input id = "dob" type = "text">
  <label>BMI: </label><input id = "bmi" type = "text">
  <label>Gender: </label>
  <select id ="gen">
    <option value = "male">Male</option>
    <option value = "female">Female</option>
    <option value = "other">Other</option>
  </select>

<h2>Medications</h2>
<h4>Current</h4> <button id = "currMedsBtn">Update Current Medications</button>
<p></p>
  <label>Medication 1: </label><input id = "med1" type = "text">
    <label>Dosage: </label><input id = "dsg1" type = "text">
    <label>Frequency: </label><input id = "frq1" type = "text">
    <label>Start Date: </label><input id = "sdate1" type = "text">
    <p></p>
  <label>Medication 2: </label><input id = "med2" type = "text">
    <label>Dosage: </label><input id = "dsg2" type = "text">
    <label>Frequency: </label><input id = "frq2" type = "text">
    <label>Start Date: </label><input id = "sdate2" type = "text">
    <p></p>
  <label>Medication 3: </label><input id = "med3" type = "text">
    <label>Dosage: </label><input id = "dsg3" type = "text">
    <label>Frequency: </label><input id = "frq3" type = "text">
    <label>Start Date: </label><input id = "sdate3" type = "text">
    <p></p>
  <label>Medication 4: </label><input id = "med4" type = "text">
    <label>Dosage: </label><input id = "dsg4" type = "text">
    <label>Frequency: </label><input id = "frq4" type = "text">
    <label>Start Date: </label><input id = "sdate4" type = "text">
    <p></p>

<h4>Past</h4> <button id = "pastMedsBtn">Update Past Medications</button>
<p></p>
  <label>Medication 1: </label><input id = "med1" type = "text">
  <label>Medication 2: </label><input id = "med2" type = "text">
  <label>Medication 3: </label><input id = "med3" type = "text">
  <label>Medication 4: </label><input id = "med4" type = "text">

<h2>Labs</h2>

  <hr>
  <button id = "inBtn">INSERT</button>
  <button id = "upBtn">UPDATE</button> <!-- have a create(similar to insert), find(similar to select), delete and update button-->
  <button id = "seBtn">SELECT</button> <!-- have an update medications button to use for updating and displaying meds-->
  <button id = "deBtn">DELETE</button>

</body>
<script type = "module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-app.js";

const firebaseConfig = {
    apiKey: "AIzaSyD2L_i9Qb9oNmi4Ksb2zpSxbSNqnTPMqVM",
    authDomain: "ehr-base.firebaseapp.com",
    projectId: "ehr-base",
    storageBucket: "ehr-base.appspot.com",
    messagingSenderId: "1011131662633",
    appId: "1:1011131662633:web:14833e1b06784c48417738",
    measurementId: "G-SEQ8ZNX56V"
  };

  // Initialize Firebase
const app = initializeApp(firebaseConfig);

import{
  getFirestore, doc, getDoc,setDoc, collection, addDoc,updateDoc,deleteDoc, deleteField
} from "https://www.gstatic.com/firebasejs/10.4.0/firebase-firestore.js";


// Initialize Cloud Firestore and get a reference to the service
const db = getFirestore();


  async function AddDocument_CustomId(){
    var ref = doc(db, ptLName.value,ptFName.value); 
    // Change statename to patient last name and Cityname to PatientFirstName so that the doc saves it under the first name
    await setDoc(
      ref, {
        Height: hgt.value,
        DOB: dob.value,
        Weight: wgt.value,
        SS: ssNum.value,
        BMI: bmi.value,
        Gender: gen.value,
      }
    ).then(()=>{
      alert("Data successfully added");
    }).catch((error)=>{
      alert("Operation failed with error"+ error);
    });
  }
  async function AddDocument_CurrMeds(){
    var docMed1Ref = doc(db,ptLName.value, ptFName.value, "Current Meds", med1.value);
    var docMed2Ref = doc(db,ptLName.value, ptFName.value, "Current Meds", med2.value);
    var docMed3Ref = doc(db,ptLName.value, ptFName.value, "Current Meds", med3.value);
    var docMed4Ref = doc(db,ptLName.value, ptFName.value, "Current Meds", med4.value);

    await setDoc(
      docMed1Ref, {
        Dosage: dsg1.value,
        Frequency: frq1.value,
        Start_Date: sdate1.value
      });
    await setDoc(
      docMed2Ref, {
        Dosage: dsg2.value,
        Frequency: frq2.value,
        Start_Date: sdate2.value
      });
    await setDoc(
      docMed3Ref, {
        Dosage: dsg3.value,
        Frequency: frq3.value,
        Start_Date: sdate3.value
      });
      await setDoc(
      docMed4Ref, {
        Dosage: dsg4.value,
        Frequency: frq4.value,
        Start_Date: sdate4.value
      }).then(()=>{
      alert("Meds successfully added");
    }).catch((error)=>{
      alert("Operation failed with error"+ error);
    });

  }
async function GetCollection(){
  var ref = collection(db,)
}

  async function GetaDocument(){
    var ref = doc(db,"Arkansas",cityName.value);
    const docSnap = await getDoc(ref);
    if(docSnap.exists()){
      country.value = docSnap.data().Country;
      hemisphere.value = docSnap.data().Hemisphere;
      stateName.value = docSnap.data().StateName;
    }else{
      alert("no such document exists");
    }
  }

  async function UpdateFieldsinDoc(){
    var ref = doc(db,"Arkansas",cityName.value);

    await updateDoc(
      ref, {
        Hemisphere: hemisphere.value,
        StateName: stateName.value,
        Country: country.value
      }
    ).then(()=>{
      alert("Data successfully updated");
    }).catch((error)=>{
      alert("Operation failed with error"+ error);
    });
  }

  async function DeleteDocument(){
    var ref = doc(db,ptLName, ptFName);
    const docSnap = await getDoc(ref);
    if(!docSnap.exists()){
      alert("no such document exists");
      return;
    }
    await deleteDoc(ref).then(()=>{
      alert("Document successfully deleted");
    }).catch((error)=>{
      alert("Operation failed with error"+ error);
    })
  }

  inBtn.addEventListener("click", AddDocument_CustomId);
  seBtn.addEventListener("click", GetaDocument);
  upBtn.addEventListener("click", UpdateFieldsinDoc);
  deBtn.addEventListener("click", DeleteDocument);
  currMedsBtn.addEventListener("click", AddDocument_CurrMeds);

</script>
</html>
